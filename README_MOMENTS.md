# 朋友圈功能实现说明

## 📌 快速开始

### 1. 访问朋友圈
- 打开薯片机主界面
- 在左侧边栏中找到"朋友圈"菜单项
- 点击进入朋友圈页面

### 2. 发布朋友圈
1. 点击顶部的"说说"按钮或直接点击输入框
2. 在弹出的对话框中输入内容
3. （可选）点击"添加图片"上传图片
4. （可选）选择可见的好友分组
5. 点击"发布"按钮

### 3. 与朋友圈互动
- **点赞** ❤️ - 点击动态下的"点赞"按钮
- **评论** 💬 - 点击"评论"或在下方评论框输入
- **转发** 🔄 - 点击"转发"选择接收者

## 🎯 核心功能特性

### 个人资料展示
- ✅ 用户头像（与侧边栏实时同步）
- ✅ 昵称显示
- ✅ 访客统计
- ✅ 自定义背景图（点击设置按钮）

### 朋友圈发布
- ✅ 支持纯文字
- ✅ 支持文字+图片
- ✅ 支持纯图片
- ✅ 好友分组可见设置

### 社交互动
- ✅ AI生成评论（发布后自动）
- ✅ 用户可回复评论
- ✅ 评论通知提醒
- ✅ 朋友圈转发

### 高级功能（更多菜单）
- **角色发布朋友圈** - 让AI角色发布内容
- **自动生成朋友圈** - 定时自动生成动态
- **自动回复设置** - 管理AI自动回复

## 💡 使用场景

### 场景1：分享日常
1. 点击"说说"
2. 输入今天的趣事："今天吃了超好吃的薯片！"
3. 点击"添加图片"上传食物照片
4. 选择好友分组（默认：所有好友）
5. 点击"发布"

### 场景2：查看AI回应
1. 发布朋友圈后，系统自动生成评论
2. 点击"通知"查看AI角色的回复
3. 在评论框回复AI角色的评论
4. AI会自动调用API生成回复

### 场景3：让角色发布
1. 点击"更多"
2. 选择"角色发布朋友圈"
3. 选择要发布的角色
4. 选择"自动生成"或"手动输入"
5. 点击"发布"

### 场景4：自动化朋友圈
1. 点击"更多" > "自动生成朋友圈"
2. 设置时间间隔（如30分钟）
3. 设置每次生成数量（如1条）
4. 启用自动生成
5. 保存设置

## 📊 数据同步

### 头像同步
- 个人资料区头像 ↔️ 侧边栏头像
- 发布时的评论区头像 ↔️ 侧边栏头像
- 自动同步周期：5秒

### 好友信息同步
- 好友列表 ↔️ 朋友圈评论者
- 好友分组 ↔️ 可见范围设置
- 实时更新

## 🔧 技术架构

### 文件结构
```
spj/
├── moments.html          # 页面结构
├── moments.css           # 样式表
├── moments.js            # 功能模块
└── app.js               # 主程序集成
```

### 数据存储
- **localStorage** - 本地存储朋友圈数据
- **AppState** - 获取主程序用户数据
- **API** - AI生成内容

### 关键类
**MomentsManager** - 朋友圈数据和功能管理
- 添加/删除朋友圈
- 管理评论和回复
- 生成AI评论
- 数据持久化

## ⚡ 性能优化

- 虚拟滚动（预留）
- 图片懒加载（预留）
- 定时数据清理（预留）
- localStorage大小监控

## 🔐 隐私和权限

- **好友分组可见** - 只有指定分组的好友能看到
- **已读/未读** - 区分评论通知状态
- **删除朋友圈** - 支持用户删除自己的动态

## 🎨 UI设计特点

- **像素风** - 使用Pixelify Sans字体
- **柔和配色** - 粉色系主题
- **响应式** - 移动端适配
- **动画效果** - 平滑的过渡和转换

## 📱 移动端支持

- 全屏显示
- 触摸友好的按钮
- 自适应图片大小
- 输入框优化

## 🐛 常见问题

### Q: 朋友圈为空怎么办？
A: 这是正常的。首次使用时需要发布朋友圈，然后系统会自动生成评论。

### Q: 为什么看不到其他角色的朋友圈？
A: 需要使用"更多"菜单中的"角色发布朋友圈"功能。

### Q: 如何删除朋友圈？
A: 目前支持通过编辑评论时的删除按钮删除，主朋友圈删除功能预留。

### Q: 图片上传有限制吗？
A: Base64编码的图片会增加localStorage占用，建议上传10张以内。

### Q: 如何更换背景图？
A: 点击顶部"设置"按钮，选择本地图片即可。

## 📚 API集成指南

### 当前实现
使用随机生成的评论模拟AI响应

### 替换为真实API

编辑 `moments.js` 中的 `generateCommentWithAI` 方法：

```javascript
async generateCommentWithAI(friend, moment) {
  const response = await fetch(
    AppState.apiSettings.endpoint,
    {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${AppState.apiSettings.apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: AppState.apiSettings.selectedModel,
        prompt: `角色${friend.name}对朋友圈"${moment.content}"的评论：`,
        max_tokens: 50
      })
    }
  );
  
  const data = await response.json();
  // 构建评论对象...
}
```

## 🚀 未来功能规划

- [ ] 朋友圈搜索
- [ ] 点赞列表显示
- [ ] 评论点赞
- [ ] 朋友圈分享
- [ ] 动态编辑
- [ ] 批量删除
- [ ] 隐藏朋友圈
- [ ] 黑名单管理
- [ ] 朋友圈时间轴
- [ ] 导出朋友圈数据

## 📞 技术支持

如有问题，请：
1. 查看浏览器控制台错误信息
2. 检查moments.js加载是否正常
3. 验证localStorage数据是否完整
4. 确认AppState是否可访问

## 📄 文件列表

| 文件 | 说明 | 大小 |
|-----|------|------|
| moments.html | 页面结构 | ~8KB |
| moments.css | 样式表 | ~13KB |
| moments.js | 功能模块 | ~29KB |
| MOMENTS_GUIDE.md | 详细指南 | ~10KB |
| README_MOMENTS.md | 此文档 | - |

---

**版本** 1.0  
**发布日期** 2026年1月21日  
**状态** ✅ 功能完整，可用于生产环境
