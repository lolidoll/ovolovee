<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord ç™»å½•ç³»ç»Ÿ - æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #ececec 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            padding: 40px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-logged-in {
            background: #d4edda;
            color: #155724;
        }
        
        .status-logged-out {
            background: #f8d7da;
            color: #721c24;
        }
        
        .info-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #333;
        }
        
        .info-value {
            color: #666;
            word-break: break-all;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #7289da;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a72c4;
        }
        
        .btn-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .btn-danger:hover {
            background: #f5c6cb;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 16px;
        }
        
        .checklist {
            list-style: none;
        }
        
        .checklist li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checklist li:before {
            content: 'âœ“';
            color: #28a745;
            font-weight: bold;
            font-size: 18px;
        }
        
        .avatar-display {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .avatar-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .feature-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .feature-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .feature-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .feature-desc {
            font-size: 13px;
            color: #666;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ Discord ç™»å½•ç³»ç»Ÿæµ‹è¯•</h1>
        <p class="subtitle">æµ‹è¯•å’ŒéªŒè¯ Discord OAuth2 ç™»å½•å®ç°</p>
        
        <!-- ç™»å½•çŠ¶æ€éƒ¨åˆ† -->
        <div class="section">
            <h2>
                ğŸ‘¤ ç™»å½•çŠ¶æ€
                <span class="status-badge" id="status-badge">æ£€æŸ¥ä¸­...</span>
            </h2>
            
            <div class="alert alert-info" id="info-alert" style="display: none;">
                <strong>â„¹ï¸ ä¿¡æ¯ï¼š</strong> è¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ã€‚
            </div>
            
            <div id="login-status-container"></div>
        </div>
        
        <!-- ç”¨æˆ·ä¿¡æ¯éƒ¨åˆ† -->
        <div class="section" id="user-section" style="display: none;">
            <h2>ğŸ‘¥ ç”¨æˆ·ä¿¡æ¯</h2>
            
            <div class="avatar-display">
                <div class="avatar-img" id="avatar-display">ğŸ‘¤</div>
                <div>
                    <div class="info-card">
                        <div class="info-row">
                            <span class="info-label">ç”¨æˆ·å</span>
                            <span class="info-value" id="user-username">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Discord ID</span>
                            <span class="info-value" id="user-id">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">é‚®ç®±</span>
                            <span class="info-value" id="user-email">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Token ä¿¡æ¯éƒ¨åˆ† -->
        <div class="section" id="token-section" style="display: none;">
            <h2>ğŸ” Token ä¿¡æ¯</h2>
            
            <div class="alert alert-warning">
                <strong>âš ï¸ å®‰å…¨æç¤ºï¼š</strong> Token å·²åŠ å¯†ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œç¡®ä¿é€šè¿‡ HTTPS ä¼ è¾“ã€‚
            </div>
            
            <div class="info-card">
                <div class="info-row">
                    <span class="info-label">Token çŠ¶æ€</span>
                    <span class="info-value" id="token-status">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Token è¿‡æœŸæ—¶é—´</span>
                    <span class="info-value" id="token-expiry">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Token é•¿åº¦</span>
                    <span class="info-value" id="token-length">-</span>
                </div>
            </div>
        </div>
        
        <!-- æœ¬åœ°å­˜å‚¨éƒ¨åˆ† -->
        <div class="section" id="storage-section" style="display: none;">
            <h2>ğŸ’¾ æœ¬åœ°å­˜å‚¨æ•°æ®</h2>
            
            <div class="alert alert-info">
                <strong>â„¹ï¸ è¯´æ˜ï¼š</strong> è¿™äº›æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨çš„ LocalStorage ä¸­ã€‚ç™»å‡ºåå°†è¢«æ¸…é™¤ã€‚
            </div>
            
            <div class="code-block" id="storage-data">æ­£åœ¨åŠ è½½...</div>
        </div>
        
        <!-- åŠŸèƒ½æµ‹è¯•éƒ¨åˆ† -->
        <div class="section">
            <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
            
            <div class="button-group">
                <button class="btn-primary" onclick="testLoginStatus()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
                <button class="btn-primary" onclick="testGetUserData()">è·å–ç”¨æˆ·æ•°æ®</button>
                <button class="btn-primary" onclick="testGetToken()">è·å– Token</button>
                <button class="btn-primary" onclick="testStorageData()">æŸ¥çœ‹å­˜å‚¨æ•°æ®</button>
                <button class="btn-secondary" onclick="testConsoleLog()">æ‰“å¼€æ§åˆ¶å°</button>
            </div>
        </div>
        
        <!-- æ“ä½œéƒ¨åˆ† -->
        <div class="section" id="action-section" style="display: none;">
            <h2>âš™ï¸ æ“ä½œ</h2>
            
            <div class="button-group">
                <button class="btn-danger" onclick="handleLogout()">
                    ğŸšª ç™»å‡º
                </button>
                <button class="btn-secondary" onclick="goToApp()">
                    â¡ï¸ è¿”å›åº”ç”¨
                </button>
                <button class="btn-secondary" onclick="goToLogin()">
                    ğŸ” é‡æ–°ç™»å½•
                </button>
            </div>
        </div>
        
        <!-- åŠŸèƒ½ç‰¹æ€§éƒ¨åˆ† -->
        <div class="section">
            <h2>âœ¨ åŠŸèƒ½ç‰¹æ€§</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ¨</div>
                    <div class="feature-title">ç®€çº¦è®¾è®¡</div>
                    <div class="feature-desc">é»‘ç™½ç°ç®€çº¦é£æ ¼ + çŒ«è€³è£…é¥°åŠ¨ç”»</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”</div>
                    <div class="feature-title">å®‰å…¨è®¤è¯</div>
                    <div class="feature-desc">Discord OAuth2 + CSRF é˜²æŠ¤</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ’¾</div>
                    <div class="feature-title">æœ¬åœ°å­˜å‚¨</div>
                    <div class="feature-desc">ç™»å½•çŠ¶æ€æŒä¹…åŒ–</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“±</div>
                    <div class="feature-title">å“åº”å¼</div>
                    <div class="feature-desc">å®Œç¾é€‚é…æ‰€æœ‰è®¾å¤‡</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸŒ™</div>
                    <div class="feature-title">æ·±è‰²æ¨¡å¼</div>
                    <div class="feature-desc">è‡ªåŠ¨é€‚é…ç³»ç»Ÿè®¾ç½®</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <div class="feature-title">å¿«é€Ÿé›†æˆ</div>
                    <div class="feature-desc">å®Œæ•´ç¤ºä¾‹å’Œæ–‡æ¡£</div>
                </div>
            </div>
        </div>
        
        <!-- å¿«é€Ÿå‚è€ƒéƒ¨åˆ† -->
        <div class="section">
            <h2>ğŸ“š å¿«é€Ÿå‚è€ƒ</h2>
            
            <p style="margin-bottom: 15px;">åœ¨æ‚¨çš„åº”ç”¨ä¸­ä½¿ç”¨ç™»å½•ç³»ç»Ÿï¼š</p>
            
            <p style="font-weight: 600; margin-bottom: 8px;">1. æ£€æŸ¥ç™»å½•çŠ¶æ€</p>
            <div class="code-block">if (authManager.isUserLoggedIn()) {
    const user = authManager.getCurrentUser();
    console.log('ç”¨æˆ·:', user);
}</div>
            
            <p style="font-weight: 600; margin-bottom: 8px;">2. è·å– Token</p>
            <div class="code-block">const token = authManager.getAuthToken();

fetch('/api/data', {
    headers: {
        'Authorization': `Bearer ${token}`
    }
})</div>
            
            <p style="font-weight: 600; margin-bottom: 8px;">3. æ‰§è¡Œç™»å‡º</p>
            <div class="code-block">authManager.logout();</div>
        </div>
        
        <!-- éƒ¨ç½²æ¸…å•éƒ¨åˆ† -->
        <div class="section">
            <h2>âœ… éƒ¨ç½²æ¸…å•</h2>
            
            <ul class="checklist">
                <li>åˆ›å»º Discord åº”ç”¨å¹¶è·å– CLIENT_ID</li>
                <li>é…ç½®é‡å®šå‘ URI</li>
                <li>åœ¨ login.js ä¸­æ›´æ–° CLIENT_ID</li>
                <li>å®ç°åç«¯è®¤è¯ APIï¼ˆå¯é€‰ä½†æ¨èï¼‰</li>
                <li>åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨ HTTPS</li>
                <li>æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹</li>
                <li>éƒ¨ç½²åˆ°æœåŠ¡å™¨</li>
                <li>è®¾ç½®ç›‘æ§å’Œæ—¥å¿—</li>
            </ul>
        </div>
        
        <!-- å¸®åŠ©é“¾æ¥éƒ¨åˆ† -->
        <div class="section">
            <h2>ğŸ†˜ å¸®åŠ©å’Œæ–‡æ¡£</h2>
            
            <p style="margin-bottom: 15px;">ç›¸å…³æ–‡æ¡£ï¼š</p>
            
            <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 10px;">
                    ğŸ“– <a href="README_LOGIN.md" target="_blank" style="color: #7289da;">README_LOGIN.md</a> 
                    - å®Œæ•´ä½¿ç”¨æŒ‡å—
                </li>
                <li style="margin-bottom: 10px;">
                    ğŸ“‹ <a href="LOGIN_GUIDE.js" target="_blank" style="color: #7289da;">LOGIN_GUIDE.js</a> 
                    - è¯¦ç»†é…ç½®æŒ‡å—
                </li>
                <li style="margin-bottom: 10px;">
                    ğŸš€ <a href="QUICK_START.md" target="_blank" style="color: #7289da;">QUICK_START.md</a> 
                    - å¿«é€Ÿéƒ¨ç½²æŒ‡å—
                </li>
                <li style="margin-bottom: 10px;">
                    ğŸ’» <a href="LOGIN_INTEGRATION_HELPER.js" target="_blank" style="color: #7289da;">LOGIN_INTEGRATION_HELPER.js</a> 
                    - é›†æˆä»£ç ç¤ºä¾‹
                </li>
                <li>
                    ğŸŒ <a href="https://discord.com/developers/docs/topics/oauth2" target="_blank" style="color: #7289da;">Discord OAuth2 æ–‡æ¡£</a>
                </li>
            </ul>
        </div>
    </div>
    
    <script src="login.js"></script>
    <script>
        // åˆå§‹åŒ–æµ‹è¯•é¡µé¢
        document.addEventListener('DOMContentLoaded', () => {
            updateLoginStatus();
            updateStorageDisplay();
        });
        
        // æ›´æ–°ç™»å½•çŠ¶æ€æ˜¾ç¤º
        function updateLoginStatus() {
            if (typeof authManager === 'undefined') {
                document.getElementById('login-status-container').innerHTML = 
                    '<div class="alert alert-warning">âš ï¸ authManager æœªåŠ è½½</div>';
                return;
            }
            
            const isLoggedIn = authManager.isUserLoggedIn();
            const statusBadge = document.getElementById('status-badge');
            const userSection = document.getElementById('user-section');
            const tokenSection = document.getElementById('token-section');
            const actionSection = document.getElementById('action-section');
            const infoAlert = document.getElementById('info-alert');
            
            if (isLoggedIn) {
                statusBadge.textContent = 'å·²ç™»å½• âœ…';
                statusBadge.className = 'status-badge status-logged-in';
                
                const user = authManager.getCurrentUser();
                if (user) {
                    document.getElementById('user-username').textContent = user.username || '-';
                    document.getElementById('user-id').textContent = user.id || '-';
                    document.getElementById('user-email').textContent = user.email || '-';
                    
                    userSection.style.display = 'block';
                    tokenSection.style.display = 'block';
                    actionSection.style.display = 'block';
                    infoAlert.style.display = 'block';
                    
                    // æ›´æ–° Token ä¿¡æ¯
                    const token = authManager.getAuthToken();
                    const expiry = localStorage.getItem('discord_token_expiry');
                    
                    document.getElementById('token-status').textContent = token ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨';
                    document.getElementById('token-length').textContent = 
                        token ? `${token.length} ä¸ªå­—ç¬¦` : '-';
                    
                    if (expiry) {
                        const expiryDate = new Date(parseInt(expiry));
                        const now = new Date();
                        const timeLeft = Math.ceil((expiryDate - now) / 1000 / 60); // åˆ†é’Ÿ
                        document.getElementById('token-expiry').textContent = 
                            `${expiryDate.toLocaleString()} (è¿˜å‰© ${timeLeft} åˆ†é’Ÿ)`;
                    }
                }
                
                document.getElementById('login-status-container').innerHTML = 
                    '<div class="alert alert-success">âœ… æ‚¨å·²æˆåŠŸç™»å½•</div>';
            } else {
                statusBadge.textContent = 'æœªç™»å½• âŒ';
                statusBadge.className = 'status-badge status-logged-out';
                userSection.style.display = 'none';
                tokenSection.style.display = 'none';
                actionSection.style.display = 'none';
                infoAlert.style.display = 'none';
                
                document.getElementById('login-status-container').innerHTML = 
                    '<div class="alert alert-warning">âš ï¸ æ‚¨æœªç™»å½•ã€‚<a href="login.html">ç‚¹å‡»è¿™é‡Œç™»å½•</a></div>';
            }
        }
        
        // æ›´æ–°å­˜å‚¨æ•°æ®æ˜¾ç¤º
        function updateStorageDisplay() {
            const storageData = {
                'discord_auth_token': localStorage.getItem('discord_auth_token') ? 
                    `å·²å­˜å‚¨ (${localStorage.getItem('discord_auth_token').length} å­—ç¬¦)` : 'æœªå­˜å‚¨',
                'discord_user_data': localStorage.getItem('discord_user_data') ? 
                    JSON.parse(localStorage.getItem('discord_user_data')) : 'æœªå­˜å‚¨',
                'discord_token_expiry': localStorage.getItem('discord_token_expiry') || 'æœªå­˜å‚¨'
            };
            
            document.getElementById('storage-data').textContent = 
                JSON.stringify(storageData, null, 2);
        }
        
        // æµ‹è¯•å‡½æ•°
        function testLoginStatus() {
            console.log('=== æ£€æŸ¥ç™»å½•çŠ¶æ€ ===');
            const isLoggedIn = authManager.isUserLoggedIn();
            console.log('å·²ç™»å½•:', isLoggedIn);
            alert('å·²ç™»å½•: ' + isLoggedIn + '\næŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ä¿¡æ¯');
        }
        
        function testGetUserData() {
            console.log('=== è·å–ç”¨æˆ·æ•°æ® ===');
            const user = authManager.getCurrentUser();
            console.log('ç”¨æˆ·æ•°æ®:', user);
            alert('ç”¨æˆ·: ' + (user ? user.username : 'æœªç™»å½•') + '\næŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ä¿¡æ¯');
        }
        
        function testGetToken() {
            console.log('=== è·å– Token ===');
            const token = authManager.getAuthToken();
            console.log('Token:', token);
            alert('Token é•¿åº¦: ' + (token ? token.length : 0) + ' å­—ç¬¦\næŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†ä¿¡æ¯');
        }
        
        function testStorageData() {
            console.log('=== å­˜å‚¨æ•°æ® ===');
            console.log('discord_auth_token:', localStorage.getItem('discord_auth_token'));
            console.log('discord_user_data:', localStorage.getItem('discord_user_data'));
            console.log('discord_token_expiry:', localStorage.getItem('discord_token_expiry'));
            updateStorageDisplay();
            alert('å­˜å‚¨æ•°æ®å·²åœ¨æ§åˆ¶å°æ˜¾ç¤º');
        }
        
        function testConsoleLog() {
            console.log('âœ… è¿™æ˜¯ä¸€æ¡æ¥è‡ªæ§åˆ¶å°çš„æµ‹è¯•æ¶ˆæ¯');
            alert('âœ… æ§åˆ¶å°å·²æ‰“å¼€\næŒ‰ F12 æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—');
        }
        
        function handleLogout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
                authManager.logout();
            }
        }
        
        function goToApp() {
            window.location.href = 'index.html';
        }
        
        function goToLogin() {
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>
