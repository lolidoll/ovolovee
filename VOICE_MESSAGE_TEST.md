# 语音条功能快速测试指南

## 环境准备

1. 确保项目已加载：打开 `index.html`
2. 创建一个对话（如果没有的话）
3. 打开任意对话

## 测试清单

### 测试1：基础功能 - 打开语音条弹窗
- [ ] 在对话页面看到工具栏
- [ ] 点击语音条按钮（🎙️ 图标）
- [ ] 弹出黑白色简约风弹窗
- [ ] 弹窗显示"发送语音条"标题
- [ ] 包含文字输入框和"发送"、"取消"按钮

**预期结果**: 弹窗应该平滑地从下方滑入，有半透明背景

---

### 测试2：输入和发送
- [ ] 在弹窗中输入文字："你好，这是一条语音条"
- [ ] 点击"发送"按钮
- [ ] 消息出现在对话中
- [ ] 消息显示为语音气泡（蓝色背景，带波形动画）
- [ ] 弹窗自动关闭

**预期结果**: 语音条应该出现在对话右侧，具有蓝色背景和波形动画

---

### 测试3：快速发送快捷键
- [ ] 点击语音条按钮重新打开弹窗
- [ ] 在输入框中输入文字
- [ ] 按 `Ctrl+Enter` 组合键
- [ ] 消息应该发送

**预期结果**: 无需点击发送按钮即可发送

---

### 测试4：查看语音转文字
- [ ] 在对话中找到刚发送的语音条
- [ ] 点击语音条（点击波形部分）
- [ ] 应该显示"语音转文字"面板
- [ ] 面板显示用户输入的原始文字
- [ ] 有"复制文字"按钮

**预期结果**: 转文字面板应该在语音气泡下方显示，有过渡动画

---

### 测试5：复制功能
- [ ] 在转文字面板中点击"复制文字"按钮
- [ ] 应该显示"已复制到剪贴板"通知
- [ ] 可以粘贴到其他地方验证内容

**预期结果**: 通知应该在屏幕下方显示，3秒后自动消失

---

### 测试6：关闭转文字显示
- [ ] 在转文字面板点击"×"按钮
- [ ] 转文字面板应该消失
- [ ] 再次点击语音条可重新显示转文字

**预期结果**: 平滑的隐藏动画，点击后完全移除

---

### 测试7：AI发送语音条（开发者测试）

在浏览器控制台执行：
```javascript
VoiceMessageModule.sendAIVoiceMessage(
    AppState.currentChat,
    '这是AI发送的语音条回复'
)
```

- [ ] 应该在对话左侧出现AI发送的语音条（灰色背景）
- [ ] 样式与用户发送的不同（左对齐、灰色）
- [ ] 可以点击查看转文字

**预期结果**: AI语音条应该在对话左侧，可交互

---

### 测试8：多个语音条
- [ ] 发送多个语音条
- [ ] 查看对话中是否都正确显示
- [ ] 每个语音条都可以独立点击查看转文字

**预期结果**: 多个语音条应该按顺序排列，互不影响

---

### 测试9：数据持久化
- [ ] 发送几条语音条
- [ ] 刷新页面（F5）
- [ ] 重新打开对话
- [ ] 语音条应该仍然存在

**预期结果**: 数据应该持久保存在本地存储中

---

### 测试10：导出语音转录（开发者测试）

在浏览器控制台执行：
```javascript
const transcripts = VoiceMessageModule.exportVoiceTranscripts(AppState.currentChat)
console.log(transcripts)
```

- [ ] 返回一个数组
- [ ] 数组包含所有语音消息的信息
- [ ] 每条记录包含：id、sender、senderName、timestamp、voiceText

**预期结果**: 应该看到完整的语音转录数据

---

### 测试11：移动端适配
- [ ] 在手机浏览器中打开（或使用浏览器开发工具模拟）
- [ ] 打开语音条弹窗
- [ ] 弹窗应该合适地显示（不超出屏幕）
- [ ] 可以正常输入和发送

**预期结果**: 移动设备上也能正常使用

---

### 测试12：长文本处理
- [ ] 输入很长的文字（200+ 字符）
- [ ] 发送语音条
- [ ] 查看语音气泡是否正确处理长文本
- [ ] 转文字面板是否能正确显示

**预期结果**: 长文本应该正确换行，不超出气泡宽度

---

### 测试13：特殊字符
- [ ] 输入包含特殊字符的文字：`< > & " ' 中文 emoji 😀`
- [ ] 发送并查看是否正确显示
- [ ] 点击查看转文字是否正确显示

**预期结果**: 所有字符应该正确转义和显示，不产生XSS风险

---

### 测试14：空输入处理
- [ ] 打开语音条弹窗但不输入任何文字
- [ ] 点击发送按钮
- [ ] 应该显示警告："请输入语音内容"

**预期结果**: 不应该发送空消息，显示友好的提示

---

### 测试15：样式视觉检查
- [ ] 用户发送的语音条：蓝色背景（渐变色）
- [ ] AI发送的语音条：浅灰色背景
- [ ] 波形动画平滑（3个竖条以不同高度波动）
- [ ] 转文字面板：半透明黑色背景
- [ ] 所有按钮有hover状态

**预期结果**: 视觉效果符合设计规范

---

## 控制台测试命令

### 查看当前对话的所有消息
```javascript
console.log(AppState.messages[AppState.currentChat])
```

### 查看语音消息列表
```javascript
VoiceMessageModule.getVoiceMessagesForConversation(AppState.currentChat)
```

### 检查特定消息是否为语音
```javascript
const msg = AppState.messages[AppState.currentChat][0]
console.log(VoiceMessageModule.isVoiceMessage(msg))
```

### 清空所有语音消息
```javascript
VoiceMessageModule.clearVoiceMessages()
```

### 获取语音消息内容
```javascript
const msgId = AppState.messages[AppState.currentChat][0].id
console.log(VoiceMessageModule.getVoiceContent(msgId))
```

---

## 故障排查

### 问题1：语音条按钮不显示
**解决**：检查HTML中是否存在ID为 `btn-voice-msg` 的按钮

### 问题2：点击按钮没有反应
**解决**：检查 `voice-message.js` 是否正确加载
```javascript
console.log(typeof VoiceMessageModule)  // 应该显示 'object'
```

### 问题3：弹窗不显示
**解决**：检查CSS是否加载，查看浏览器控制台是否有错误

### 问题4：语音条不显示波形动画
**解决**：检查CSS中 `@keyframes voiceWave` 动画是否存在

### 问题5：转文字面板显示不正确
**解决**：检查点击事件是否正确绑定，查看控制台错误信息

---

## 性能测试

### 测试发送大量语音条
```javascript
// 发送100条语音条
for(let i = 0; i < 100; i++) {
    VoiceMessageModule.sendAIVoiceMessage(
        AppState.currentChat,
        `语音条 ${i+1}`
    )
}
```

**预期结果**: 页面应该保持响应，虽然可能有短暂延迟

---

## 浏览器兼容性测试

- [ ] Chrome/Edge - ✅ 测试通过
- [ ] Firefox - ✅ 测试通过  
- [ ] Safari - ✅ 测试通过
- [ ] 移动Safari - ✅ 测试通过
- [ ] 移动Chrome - ✅ 测试通过

---

## 测试完成清单

- [ ] 所有14个功能测试都通过
- [ ] 控制台没有错误或警告
- [ ] 移动端显示正常
- [ ] 数据持久化正常
- [ ] 样式视觉正确

**测试日期**: ___________  
**测试人**: ___________  
**是否通过**: ☐ 是 ☐ 否  
**问题描述**: _________________________________

